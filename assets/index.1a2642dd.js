var ge=Object.defineProperty;var D=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var te=(r,i,n)=>i in r?ge(r,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[i]=n,I=(r,i)=>{for(var n in i||(i={}))re.call(i,n)&&te(r,n,i[n]);if(D)for(var n of D(i))oe.call(i,n)&&te(r,n,i[n]);return r};var ne=(r,i)=>{var n={};for(var a in r)re.call(r,a)&&i.indexOf(a)<0&&(n[a]=r[a]);if(r!=null&&D)for(var a of D(r))i.indexOf(a)<0&&oe.call(r,a)&&(n[a]=r[a]);return n};import{c as de}from"./index.ab097df6.js";function ve(r,i){return i.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(a){if(a!=="default"&&!(a in r)){var l=Object.getOwnPropertyDescriptor(n,a);Object.defineProperty(r,a,l.get?l:{enumerable:!0,get:function(){return n[a]}})}})}),Object.freeze(r)}var we={exports:{}};(function(r){var i=function(n){var a=Object.prototype,l=a.hasOwnProperty,c,m=typeof Symbol=="function"?Symbol:{},h=m.iterator||"@@iterator",$=m.asyncIterator||"@@asyncIterator",k=m.toStringTag||"@@toStringTag";function v(t,e,o){return Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{v({},"")}catch{v=function(e,o,f){return e[o]=f}}function A(t,e,o,f){var s=e&&e.prototype instanceof G?e:G,p=Object.create(s.prototype),y=new Y(f||[]);return p._invoke=he(t,o,y),p}n.wrap=A;function _(t,e,o){try{return{type:"normal",arg:t.call(e,o)}}catch(f){return{type:"throw",arg:f}}}var U="suspendedStart",x="suspendedYield",B="executing",C="completed",L={};function G(){}function O(){}function u(){}var g={};v(g,h,function(){return this});var d=Object.getPrototypeOf,j=d&&d(d(q([])));j&&j!==a&&l.call(j,h)&&(g=j);var w=u.prototype=G.prototype=Object.create(g);O.prototype=u,v(w,"constructor",u),v(u,"constructor",O),O.displayName=v(u,k,"GeneratorFunction");function M(t){["next","throw","return"].forEach(function(e){v(t,e,function(o){return this._invoke(e,o)})})}n.isGeneratorFunction=function(t){var e=typeof t=="function"&&t.constructor;return e?e===O||(e.displayName||e.name)==="GeneratorFunction":!1},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,v(t,k,"GeneratorFunction")),t.prototype=Object.create(w),t},n.awrap=function(t){return{__await:t}};function W(t,e){function o(p,y,b,F){var E=_(t[p],t,y);if(E.type==="throw")F(E.arg);else{var H=E.arg,T=H.value;return T&&typeof T=="object"&&l.call(T,"__await")?e.resolve(T.__await).then(function(S){o("next",S,b,F)},function(S){o("throw",S,b,F)}):e.resolve(T).then(function(S){H.value=S,b(H)},function(S){return o("throw",S,b,F)})}}var f;function s(p,y){function b(){return new e(function(F,E){o(p,y,F,E)})}return f=f?f.then(b,b):b()}this._invoke=s}M(W.prototype),v(W.prototype,$,function(){return this}),n.AsyncIterator=W,n.async=function(t,e,o,f,s){s===void 0&&(s=Promise);var p=new W(A(t,e,o,f),s);return n.isGeneratorFunction(e)?p:p.next().then(function(y){return y.done?y.value:p.next()})};function he(t,e,o){var f=U;return function(p,y){if(f===B)throw new Error("Generator is already running");if(f===C){if(p==="throw")throw y;return ee()}for(o.method=p,o.arg=y;;){var b=o.delegate;if(b){var F=X(b,o);if(F){if(F===L)continue;return F}}if(o.method==="next")o.sent=o._sent=o.arg;else if(o.method==="throw"){if(f===U)throw f=C,o.arg;o.dispatchException(o.arg)}else o.method==="return"&&o.abrupt("return",o.arg);f=B;var E=_(t,e,o);if(E.type==="normal"){if(f=o.done?C:x,E.arg===L)continue;return{value:E.arg,done:o.done}}else E.type==="throw"&&(f=C,o.method="throw",o.arg=E.arg)}}}function X(t,e){var o=t.iterator[e.method];if(o===c){if(e.delegate=null,e.method==="throw"){if(t.iterator.return&&(e.method="return",e.arg=c,X(t,e),e.method==="throw"))return L;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return L}var f=_(o,t.iterator,e.arg);if(f.type==="throw")return e.method="throw",e.arg=f.arg,e.delegate=null,L;var s=f.arg;if(!s)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,L;if(s.done)e[t.resultName]=s.value,e.next=t.nextLoc,e.method!=="return"&&(e.method="next",e.arg=c);else return s;return e.delegate=null,L}M(w),v(w,k,"Generator"),v(w,h,function(){return this}),v(w,"toString",function(){return"[object Generator]"});function me(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function z(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Y(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(me,this),this.reset(!0)}n.keys=function(t){var e=[];for(var o in t)e.push(o);return e.reverse(),function f(){for(;e.length;){var s=e.pop();if(s in t)return f.value=s,f.done=!1,f}return f.done=!0,f}};function q(t){if(t){var e=t[h];if(e)return e.call(t);if(typeof t.next=="function")return t;if(!isNaN(t.length)){var o=-1,f=function s(){for(;++o<t.length;)if(l.call(t,o))return s.value=t[o],s.done=!1,s;return s.value=c,s.done=!0,s};return f.next=f}}return{next:ee}}n.values=q;function ee(){return{value:c,done:!0}}return Y.prototype={constructor:Y,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(z),!t)for(var e in this)e.charAt(0)==="t"&&l.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=c)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function o(F,E){return p.type="throw",p.arg=t,e.next=F,E&&(e.method="next",e.arg=c),!!E}for(var f=this.tryEntries.length-1;f>=0;--f){var s=this.tryEntries[f],p=s.completion;if(s.tryLoc==="root")return o("end");if(s.tryLoc<=this.prev){var y=l.call(s,"catchLoc"),b=l.call(s,"finallyLoc");if(y&&b){if(this.prev<s.catchLoc)return o(s.catchLoc,!0);if(this.prev<s.finallyLoc)return o(s.finallyLoc)}else if(y){if(this.prev<s.catchLoc)return o(s.catchLoc,!0)}else if(b){if(this.prev<s.finallyLoc)return o(s.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(t,e){for(var o=this.tryEntries.length-1;o>=0;--o){var f=this.tryEntries[o];if(f.tryLoc<=this.prev&&l.call(f,"finallyLoc")&&this.prev<f.finallyLoc){var s=f;break}}s&&(t==="break"||t==="continue")&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var p=s?s.completion:{};return p.type=t,p.arg=e,s?(this.method="next",this.next=s.finallyLoc,L):this.complete(p)},complete:function(t,e){if(t.type==="throw")throw t.arg;return t.type==="break"||t.type==="continue"?this.next=t.arg:t.type==="return"?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):t.type==="normal"&&e&&(this.next=e),L},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),z(o),L}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.tryLoc===t){var f=o.completion;if(f.type==="throw"){var s=f.arg;z(o)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,o){return this.delegate={iterator:q(t),resultName:e,nextLoc:o},this.method==="next"&&(this.arg=c),L}},n}(r.exports);try{regeneratorRuntime=i}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=i:Function("r","regeneratorRuntime = r")(i)}})(we);var ye={defaultArgs:["./ffmpeg","-nostdin","-y"],baseOptions:{log:!1,logger:()=>{},progress:()=>{},corePath:""}};let K=!1,ce=()=>{};const be=r=>{K=r},Ee=r=>{ce=r},Le=(r,i)=>{ce({type:r,message:i}),K&&console.log(`[${r}] ${i}`)};var le={logging:K,setLogging:be,setCustomLogger:Ee,log:Le};let N=0,J=0;const ie=r=>{const[i,n,a]=r.split(":");return parseFloat(i)*60*60+parseFloat(n)*60+parseFloat(a)};var Fe=(r,i)=>{if(typeof r=="string")if(r.startsWith("  Duration")){const n=r.split(", ")[0].split(": ")[1],a=ie(n);i({duration:a,ratio:J}),(N===0||N>a)&&(N=a)}else if(r.startsWith("frame")||r.startsWith("size")){const n=r.split("time=")[1].split(" ")[0],a=ie(n);J=a/N,i({ratio:J,time:a})}else r.startsWith("video:")&&(i({ratio:1}),N=0)},$e=(r,i)=>{const n=r._malloc(i.length*Uint32Array.BYTES_PER_ELEMENT);return i.forEach((a,l)=>{const c=r._malloc(a.length+1);r.writeAsciiToMemory(a,c),r.setValue(n+Uint32Array.BYTES_PER_ELEMENT*l,c,"i32")}),[i.length,n]},Q={exports:{}};(function(r,i){(function(n,a){r.exports=a()})(de,function(){function n(){var a=arguments.length;if(a===0)throw new Error("resolveUrl requires at least one argument; got none.");var l=document.createElement("base");if(l.href=arguments[0],a===1)return l.href;var c=document.getElementsByTagName("head")[0];c.insertBefore(l,c.firstChild);for(var m=document.createElement("a"),h,$=1;$<a;$++)m.href=arguments[$],h=m.href,l.href=h;return c.removeChild(l),h}return n})})(Q);const je="@ffmpeg/ffmpeg",Oe="0.10.1",Se="FFmpeg WebAssembly version",Pe="src/index.js",ke="src/index.d.ts",Ce={example:"examples"},Ae={start:"node scripts/server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js",prepublishOnly:"npm run build",lint:"eslint src",wait:"rimraf dist && wait-on http://localhost:3000/dist/ffmpeg.dev.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:ffmpeg test:node:all","test:node":"node --experimental-wasm-threads --experimental-wasm-bulk-memory node_modules/.bin/_mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser":"mocha-headless-chrome -a allow-file-access-from-files -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:ffmpeg":"npm run test:browser -- -f ./tests/ffmpeg.test.html"},_e={"./src/node/index.js":"./src/browser/index.js"},Ge={type:"git",url:"git+https://github.com/ffmpegwasm/ffmpeg.wasm.git"},Te=["ffmpeg","WebAssembly","video"],Ne="Jerome Wu <jeromewus@gmail.com>",Re="MIT",Ue={url:"https://github.com/ffmpegwasm/ffmpeg.wasm/issues"},Be={node:">=12.16.1"},Me="https://github.com/ffmpegwasm/ffmpeg.wasm#readme",We={"is-url":"^1.2.4","node-fetch":"^2.6.1","regenerator-runtime":"^0.13.7","resolve-url":"^0.2.1"},De={"@babel/core":"^7.12.3","@babel/preset-env":"^7.12.1","@ffmpeg/core":"^0.10.0","@types/emscripten":"^1.39.4","babel-loader":"^8.1.0",chai:"^4.2.0",cors:"^2.8.5",eslint:"^7.12.1","eslint-config-airbnb-base":"^14.1.0","eslint-plugin-import":"^2.22.1",express:"^4.17.1",mocha:"^8.2.1","mocha-headless-chrome":"^2.0.3","npm-run-all":"^4.1.5","wait-on":"^5.3.0",webpack:"^5.3.2","webpack-cli":"^4.1.0","webpack-dev-middleware":"^4.0.0"};var ue={name:je,version:Oe,description:Se,main:Pe,types:ke,directories:Ce,scripts:Ae,browser:_e,repository:Ge,keywords:Te,author:Ne,license:Re,bugs:Ue,engines:Be,homepage:Me,dependencies:We,devDependencies:De};const{devDependencies:Ie}=ue;var xe={corePath:`https://unpkg.com/@ffmpeg/core@${Ie["@ffmpeg/core"].substring(1)}/dist/ffmpeg-core.js`};const ze=Q.exports,{log:R}=le,V=async(r,i)=>{R("info",`fetch ${r}`);const n=await(await fetch(r)).arrayBuffer();R("info",`${r} file size = ${n.byteLength} bytes`);const a=new Blob([n],{type:i}),l=URL.createObjectURL(a);return R("info",`${r} blob URL = ${l}`),l};var Ye=async({corePath:r})=>{if(typeof r!="string")throw Error("corePath should be a string!");const i=ze(r),n=await V(i,"application/javascript"),a=await V(i.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),l=await V(i.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore=="undefined"?new Promise(c=>{const m=document.createElement("script"),h=()=>{m.removeEventListener("load",h),R("info","ffmpeg-core.js script loaded"),c({createFFmpegCore,corePath:n,wasmPath:a,workerPath:l})};m.src=n,m.type="text/javascript",m.addEventListener("load",h),document.getElementsByTagName("head")[0].appendChild(m)}):(R("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:n,wasmPath:a,workerPath:l}))};const qe=Q.exports,He=r=>new Promise((i,n)=>{const a=new FileReader;a.onload=()=>{i(a.result)},a.onerror=({target:{error:{code:l}}})=>{n(Error(`File could not be read! Code=${l}`))},a.readAsArrayBuffer(r)});var Je=async r=>{let i=r;return typeof r=="undefined"?new Uint8Array:(typeof r=="string"?/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(r)?i=atob(r.split(",")[1]).split("").map(n=>n.charCodeAt(0)):i=await(await fetch(qe(r))).arrayBuffer():(r instanceof File||r instanceof Blob)&&(i=await He(r)),new Uint8Array(i))};const Ve=xe,Ze=Ye,Ke=Je;var pe={defaultOptions:Ve,getCreateFFmpegCore:Ze,fetchFile:Ke};const{defaultArgs:Qe,baseOptions:Xe}=ye,{setLogging:ae,setCustomLogger:se,log:P}=le,et=Fe,tt=$e,{defaultOptions:rt,getCreateFFmpegCore:ot}=pe,{version:nt}=ue,Z=Error("ffmpeg.wasm is not ready, make sure you have completed load().");var it=(r={})=>{const O=I(I(I({},Xe),rt),r),{log:i,logger:n,progress:a}=O,l=ne(O,["log","logger","progress"]);let c=null,m=null,h=null,$=!1,k=a;const v=u=>{u==="FFMPEG_END"&&h!==null&&(h(),h=null,$=!1)},A=({type:u,message:g})=>{P(u,g),et(g,k),v(g)},_=async()=>{if(P("info","load ffmpeg-core"),c===null){P("info","loading ffmpeg-core");const{createFFmpegCore:u,corePath:g,workerPath:d,wasmPath:j}=await ot(l);c=await u({mainScriptUrlOrBlob:g,printErr:w=>A({type:"fferr",message:w}),print:w=>A({type:"ffout",message:w}),locateFile:(w,M)=>{if(typeof window!="undefined"){if(typeof j!="undefined"&&w.endsWith("ffmpeg-core.wasm"))return j;if(typeof d!="undefined"&&w.endsWith("ffmpeg-core.worker.js"))return d}return M+w}}),m=c.cwrap("proxy_main","number",["number","number"]),P("info","ffmpeg-core loaded")}else throw Error("ffmpeg.wasm was loaded, you should not load it again, use ffmpeg.isLoaded() to check next time.")},U=()=>c!==null,x=(...u)=>{if(P("info",`run ffmpeg command: ${u.join(" ")}`),c===null)throw Z;if($)throw Error("ffmpeg.wasm can only run one command at a time");return $=!0,new Promise(g=>{const d=[...Qe,...u].filter(j=>j.length!==0);h=g,m(...tt(c,d))})},B=(u,...g)=>{if(P("info",`run FS.${u} ${g.map(d=>typeof d=="string"?d:`<${d.length} bytes binary file>`).join(" ")}`),c===null)throw Z;{let d=null;try{d=c.FS[u](...g)}catch{throw Error(u==="readdir"?`ffmpeg.FS('readdir', '${g[0]}') error. Check if the path exists, ex: ffmpeg.FS('readdir', '/')`:u==="readFile"?`ffmpeg.FS('readFile', '${g[0]}') error. Check if the path exists`:"Oops, something went wrong in FS operation.")}return d}},C=()=>{if(c===null)throw Z;$=!1,c.exit(1),c=null,m=null,h=null},L=u=>{k=u},G=u=>{se(u)};return ae(i),se(n),P("info",`use ffmpeg.wasm v${nt}`),{setProgress:L,setLogger:G,setLogging:ae,load:_,isLoaded:U,run:x,exit:C,FS:B}};const at=it,{fetchFile:st}=pe;var fe={createFFmpeg:at,fetchFile:st},lt=Object.freeze(ve({__proto__:null,[Symbol.toStringTag]:"Module",default:fe},[fe]));export{lt as i};
